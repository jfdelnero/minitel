#include "low_pass_tx_Filter.h"

static float filter_taps[LOW_PASS_TX_FILTER_TAP_NUM] = {
  -0.006151243034334464,
  -0.003537356538820365,
  -0.004400277419538578,
  -0.005271046438615664,
  -0.0061003118798902325,
  -0.006858711368325623,
  -0.007467933297628868,
  -0.007883230285383113,
  -0.008041841404104785,
  -0.007883985004975079,
  -0.007360054468095985,
  -0.006413738403683125,
  -0.005005465790762006,
  -0.003104247936722645,
  -0.0006911466874211853,
  0.0022331022307231995,
  0.005657792306298428,
  0.009553098136084556,
  0.013872890146356176,
  0.018556362291392018,
  0.023523524613613307,
  0.028683762260631306,
  0.03393438565531518,
  0.039164210807451964,
  0.04425921200679992,
  0.04910099712285271,
  0.05357478031861746,
  0.057571300543507724,
  0.060989903427362914,
  0.06374520919484737,
  0.06576582356444166,
  0.06699960137744337,
  0.06741483860719244,
  0.06699960137744337,
  0.06576582356444166,
  0.06374520919484737,
  0.060989903427362914,
  0.057571300543507724,
  0.05357478031861746,
  0.04910099712285271,
  0.04425921200679992,
  0.039164210807451964,
  0.03393438565531518,
  0.028683762260631306,
  0.023523524613613307,
  0.018556362291392018,
  0.013872890146356176,
  0.009553098136084556,
  0.005657792306298428,
  0.0022331022307231995,
  -0.0006911466874211853,
  -0.003104247936722645,
  -0.005005465790762006,
  -0.006413738403683125,
  -0.007360054468095985,
  -0.007883985004975079,
  -0.008041841404104785,
  -0.007883230285383113,
  -0.007467933297628868,
  -0.006858711368325623,
  -0.0061003118798902325,
  -0.005271046438615664,
  -0.004400277419538578,
  -0.003537356538820365,
  -0.006151243034334464
};

void low_pass_tx_Filter_init(low_pass_tx_Filter* f) {
  int i;
  for(i = 0; i < LOW_PASS_TX_FILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void low_pass_tx_Filter_put(low_pass_tx_Filter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LOW_PASS_TX_FILTER_TAP_NUM)
    f->last_index = 0;
}

float low_pass_tx_Filter_get(low_pass_tx_Filter* f) {
  float acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LOW_PASS_TX_FILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LOW_PASS_TX_FILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}

