#include "low_pass_tx_Filter.h"

static float filter_taps[LOW_PASS_TX_FILTER_TAP_NUM] = {
  -0.006415381919508891,
  -0.0033903582034142893,
  -0.004191048291449409,
  -0.005037794481981075,
  -0.005911488237092987,
  -0.006788788886890344,
  -0.007642383387745853,
  -0.008442162035449466,
  -0.00915532053373463,
  -0.009747150768693294,
  -0.010182335291092222,
  -0.01042647546090505,
  -0.010440315865210725,
  -0.010204111357449388,
  -0.0096662190583277,
  -0.008827015911172513,
  -0.007651911292338178,
  -0.006125191880224299,
  -0.004247283709063688,
  -0.0020190115354389955,
  0.0005553753540395857,
  0.0034608787379979194,
  0.006670821487004569,
  0.010150324144106087,
  0.0138589831652617,
  0.017752376902845254,
  0.021773382232998097,
  0.025868313572151982,
  0.02996645961069407,
  0.03400559093225916,
  0.03791824629589357,
  0.041636895279407726,
  0.04509812934672063,
  0.04824049568081967,
  0.051005652992246416,
  0.05334158420491787,
  0.05520437054476665,
  0.05655990700751527,
  0.05738415118530103,
  0.05765913947813418,
  0.05738415118530103,
  0.05655990700751527,
  0.05520437054476665,
  0.05334158420491787,
  0.051005652992246416,
  0.04824049568081967,
  0.04509812934672063,
  0.041636895279407726,
  0.03791824629589357,
  0.03400559093225916,
  0.02996645961069407,
  0.025868313572151982,
  0.021773382232998097,
  0.017752376902845254,
  0.0138589831652617,
  0.010150324144106087,
  0.006670821487004569,
  0.0034608787379979194,
  0.0005553753540395857,
  -0.0020190115354389955,
  -0.004247283709063688,
  -0.006125191880224299,
  -0.007651911292338178,
  -0.008827015911172513,
  -0.0096662190583277,
  -0.010204111357449388,
  -0.010440315865210725,
  -0.01042647546090505,
  -0.010182335291092222,
  -0.009747150768693294,
  -0.00915532053373463,
  -0.008442162035449466,
  -0.007642383387745853,
  -0.006788788886890344,
  -0.005911488237092987,
  -0.005037794481981075,
  -0.004191048291449409,
  -0.0033903582034142893,
  -0.006415381919508891
};

void low_pass_tx_Filter_init(low_pass_tx_Filter* f) {
  int i;
  for(i = 0; i < LOW_PASS_TX_FILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void low_pass_tx_Filter_put(low_pass_tx_Filter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == LOW_PASS_TX_FILTER_TAP_NUM)
    f->last_index = 0;
}

float low_pass_tx_Filter_get(low_pass_tx_Filter* f) {
  float acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < LOW_PASS_TX_FILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : LOW_PASS_TX_FILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
