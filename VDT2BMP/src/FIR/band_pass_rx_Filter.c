#include "band_pass_rx_Filter.h"

static float filter_taps[BAND_PASS_RX_FILTER_TAP_NUM] = {
  0.004191728301399515,
  0.002394007092150607,
  0.006119979506783222,
  0.007774174962865956,
  0.005050743141648877,
  -0.0016397269480294147,
  -0.010215630753109268,
  -0.018150535120810742,
  -0.022978590474222783,
  -0.022616658550624603,
  -0.016070470071289224,
  -0.004313156929361593,
  0.009479634666444909,
  0.020936130488877037,
  0.02623307512335283,
  0.023894797486303687,
  0.015591242992059846,
  0.005594207522930457,
  -0.0009930569961634848,
  -0.0005440154922539318,
  0.0071646108655934815,
  0.018317031953055625,
  0.026178024519712743,
  0.02374852446769645,
  0.007019725069140523,
  -0.022557967534969265,
  -0.05752537192314953,
  -0.08632420457882714,
  -0.09715794976828741,
  -0.08247656583075927,
  -0.042365636866302646,
  0.014575035267286861,
  0.07340425320593917,
  0.11744528005461843,
  0.13374737892089802,
  0.11744528005461843,
  0.07340425320593917,
  0.014575035267286861,
  -0.042365636866302646,
  -0.08247656583075927,
  -0.09715794976828741,
  -0.08632420457882714,
  -0.05752537192314953,
  -0.022557967534969265,
  0.007019725069140523,
  0.02374852446769645,
  0.026178024519712743,
  0.018317031953055625,
  0.0071646108655934815,
  -0.0005440154922539318,
  -0.0009930569961634848,
  0.005594207522930457,
  0.015591242992059846,
  0.023894797486303687,
  0.02623307512335283,
  0.020936130488877037,
  0.009479634666444909,
  -0.004313156929361593,
  -0.016070470071289224,
  -0.022616658550624603,
  -0.022978590474222783,
  -0.018150535120810742,
  -0.010215630753109268,
  -0.0016397269480294147,
  0.005050743141648877,
  0.007774174962865956,
  0.006119979506783222,
  0.002394007092150607,
  0.004191728301399515
};

void band_pass_rx_Filter_init(band_pass_rx_Filter* f) {
  int i;
  for(i = 0; i < BAND_PASS_RX_FILTER_TAP_NUM; ++i)
    f->history[i] = 0;
  f->last_index = 0;
}

void band_pass_rx_Filter_put(band_pass_rx_Filter* f, float input) {
  f->history[f->last_index++] = input;
  if(f->last_index == BAND_PASS_RX_FILTER_TAP_NUM)
    f->last_index = 0;
}

float band_pass_rx_Filter_get(band_pass_rx_Filter* f) {
  float acc = 0;
  int index = f->last_index, i;
  for(i = 0; i < BAND_PASS_RX_FILTER_TAP_NUM; ++i) {
    index = index != 0 ? index-1 : BAND_PASS_RX_FILTER_TAP_NUM-1;
    acc += f->history[index] * filter_taps[i];
  };
  return acc;
}
